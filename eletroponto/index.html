<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Trabalho php</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <style>
        table {
            font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        table td, table th {
            border: 1px solid #ddd;
            padding: 8px;
        }

        table tr:nth-child(even){background-color: #f2f2f2;}

        table tr:hover {background-color: #ddd;}

        table th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            background-color: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>
<div id="app">
    <label for="hora">Hora:</label>
    <input type="time" name="hora" v-model="hora">
    <button @click="guardaTempo">Adicionar Ponto</button>
    <table>
        <tr>
            <th v-for="(ponto,index) in pontos"><span v-if="index % 2 === 1">Sa√≠da</span><span v-else>Entrada</span></th>
            <th v-if = "pontos.length % 2 ===1">Agora</th>
            <th v-if="pontos.length > 0">Tempo Trabalhado</th>
        </tr>
        <tr>
            <td v-for="ponto in pontos">{{ponto}}</td>
            <td v-if="pontos.length % 2 ===1">{{horaAgora}}</td>
            <td v-if="pontos.length > 0">{{horaFim}}</td>
        </tr>
    </table>
    <br><br><br><br><br>
    <!--<pre>-->
<!--hora: {{hora}}-->
<!--pontos:{{pontos}}-->
<!--horaAgora:{{horaAgora}}-->
<!--agora:{{agora}}-->
<!--entradas:{{entradas}}-->
<!--saidas:{{saidas}}</pre>-->
</div>
<script type="text/javascript">

    var app = new Vue({
        el: '#app',
        data: {
            hora: '',
            pontos: [],
            entradas:[],
            saidas:[],
            agora: '',
            horaSaida:''
        },
        computed: {
            horaAgora() {
                getHoraAgora = () => {
                    var date = new Date();
                    var hora = [];
                    hora.push((date.getHours() < 10) ? '0' + date.getHours() : date.getHours());
                    hora.push((date.getMinutes() < 10) ? '0' + date.getMinutes() : date.getMinutes());
                    return hora.join(":");
                };
                setInterval(() => {
                    this.agora = getHoraAgora();
                }, 1000);
                return this.agora;
            },
            horaFim() {
                entradas = this.entradas;
                saidas = this.saidas;
                if (this.pontos.length>2) {
                    if (this.pontos.length % 2 === 0) {
                        entradas = this.entradas.reduce((a, b) => {
                            return this.somaTempo(a, b)
                        });
                        saidas = this.saidas.reduce((a, b) => {
                            return this.somaTempo(a, b)
                        });
                    } else {
                        entradas = this.entradas.reduce((a, b) => {
                            return this.somaTempo(a, b)
                        });
                        saidas = this.saidas.reduce((a, b) => {
                            return this.somaTempo(a, b)
                        }, this.horaAgora);
                    }
                    this.horaSaida = this.diferencaTempo(entradas,saidas);
                }else if(this.pontos.length===1)
                    this.horaSaida = this.diferencaTempo(entradas[0],this.horaAgora);
                else if(this.pontos.length===2)
                    this.horaSaida = this.diferencaTempo(entradas[0],saidas[0]);
                return this.horaSaida;

            }
        },
        methods: {
            guardaTempo() {
                if (this.hora.length > 0) {
                    this.pontos.push(this.hora);
                    if (this.pontos.length % 2 === 0)
                        this.saidas.push(this.hora);
                    else
                        this.entradas.push(this.hora);
                }
            },
            diferencaTempo(inicio, fim) {
                inicio = inicio.split(':');
                fim = fim.split(':');

                hora = fim[0] - inicio[0];
                minuto = fim[1] - inicio[1];
                if (minuto<0){
                    hora--;
                    minuto+=60;
                }

                hora = ((hora < 10 && hora > 0) ? '0' + hora : hora);
                minuto = ((minuto < 10) ? '0' + minuto : minuto);
                return hora + ":" + minuto
            },
            somaTempo(inicio, fim){
                inicio = inicio.split(':');
                fim = fim.split(':');

                hora = parseInt(fim[0]) + parseInt(inicio[0]);
                minuto = parseInt(fim[1]) + parseInt(inicio[1]);
                if (minuto>60){
                    hora++;
                    minuto-=60;
                }

                hora = ((hora < 10) ? '0' + hora : hora);
                minuto = ((minuto < 10) ? '0' + minuto : minuto);
                return hora + ":" + minuto
            }
        }

    })

</script>
</body>

</html>